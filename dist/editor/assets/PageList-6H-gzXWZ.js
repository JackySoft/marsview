import{a as E,u as L,b as O,j as e,C as U,m as j,c as I,M as D,e as z,f as w}from"./index-DY_7v7QC.js";import{s as l}from"./index.module-DFRKY25f.js";import{E as A,C as F,S as $,a,b as d}from"./SendOutlined-CJneGZsp.js";import{U as B}from"./UserOutlined-DTflXYad.js";import{D as M}from"./DeleteOutlined-6kPzICbB.js";const G=window.React.useEffect,H=window.React.useRef,p=window.React.useState,V=window.antd.Button,W=window.antd.Col,q=window.antd.Empty,J=window.antd.Image,K=window.antd.Layout,Q=window.antd.Pagination,X=window.antd.Row,Y=window.antd.Spin,u=window.antd.Tag,r=window.antd.Tooltip,Z=window.dayjs;function le(){const[o,n]=p(!0),[i,c]=p([]),[h,_]=p(0),[f,v]=p(1),[m,C]=p(!1),[R,T]=p(""),y=H(),{userInfo:te,isUpdateList:k}=E(t=>({userInfo:t.userInfo,isUpdateList:t.isUpdateList})),P=L();G(()=>{x()},[k]);const x=async(t=f)=>{n(!0);try{const s=await O({pageNum:t,pageSize:12});_((s==null?void 0:s.total)||0),c((s==null?void 0:s.list)||[]),n(!1)}catch{n(!1)}},S=t=>{v(t),x(t)},b=()=>{var t;(t=y.current)==null||t.open()},g=async(t,s,N)=>{if(t==="preview"){if(!s.preview_img)return j.warning("该页面未生成预览图");T(s.preview_img),C(!0);return}if(!N)return j.warning("该页面未授权，无法访问");if(t==="edit")return P(`/editor/${s==null?void 0:s.id}/edit`);t==="copy"&&(await I({id:s.id}),j.success("复制成功"),x()),t==="delete"&&D.confirm({title:"确认",content:"确认删除吗？",okText:"确认",cancelText:"取消",onOk:async()=>{await z({id:s.id}),j.success("删除成功"),x()}})};return e.jsx(e.Fragment,{children:e.jsxs(K.Content,{className:l.pageList,children:[e.jsx(Y,{spinning:o,size:"large",children:e.jsx(X,{gutter:[20,20],children:i.map(t=>{const s=!!t.id;return e.jsx(W,{span:6,children:e.jsxs("section",{className:l.card,style:{borderRadius:8,opacity:s?1:.6,background:s?"none":"url('/imgs/cross-bg.png')",overflow:"hidden"},children:[e.jsxs("div",{className:l.itemContent,onClick:()=>g("edit",t,s),children:[e.jsx("div",{className:l.itemHeader,children:e.jsx(ee,{item:t})}),e.jsx("div",{className:l.itemTitle,children:t.name}),e.jsx("div",{className:l.itemRemark,children:t.remark}),e.jsxs("div",{className:l.updateUser,children:[e.jsxs("span",{style:{marginRight:10},children:[e.jsx(B,{style:{fontSize:15,marginRight:5}}),t.sso_name]}),e.jsxs("span",{children:["更新时间：",Z(t.updated_at).fromNow()]})]})]}),e.jsxs("div",{className:l.itemFooter,children:[e.jsx(r,{title:"效果图预览",children:e.jsx(A,{onClick:()=>g("preview",t,s)})}),e.jsx(r,{title:"页面复制",children:e.jsx(F,{onClick:()=>g("copy",t,s)})}),e.jsx(r,{title:"页面删除",children:e.jsx(M,{onClick:()=>g("delete",t,s)})}),e.jsx(r,{title:"页面访问",children:e.jsx($,{onClick:()=>{window.open(`https://admin.marsview.cc/page/prd/${t.id}`,"_blank")}})})]})]},t.id)},t.id)})})}),e.jsx(J,{style:{display:"none"},src:R,preview:{visible:m,onVisibleChange:t=>{C(t)}}}),h>0?e.jsx(Q,{style:{textAlign:"right",marginTop:16},total:h,current:f,pageSize:12,showTotal:t=>`总共 ${t} 条`,onChange:S}):!o&&e.jsx(q,{style:{marginTop:100},children:e.jsx(V,{type:"primary",onClick:b,children:"创建页面"})}),e.jsx(U,{createRef:y})]})})}const ee=({item:o})=>{if(o.stg_state===1&&o.pre_state===1&&o.prd_state===1)return e.jsx(u,{children:e.jsx(r,{title:"待开发",children:"NEW"})});let n={color:"",icon:e.jsx(a,{}),tooltip:"已发布"},i={color:"",icon:e.jsx(a,{}),tooltip:"已发布"},c={color:"",icon:e.jsx(a,{}),tooltip:"已发布"};return o.stg_state===4?n={color:"red",icon:e.jsx(d,{}),tooltip:"版本已回滚"}:o.stg_state===3?n={color:"success",icon:e.jsx(a,{}),tooltip:"版本已发布"}:o.stg_state===2&&o.stg_publish_id?n={color:"warning",icon:e.jsx(d,{}),tooltip:"版本已落后"}:n={color:"",icon:e.jsx(w,{}),tooltip:"版本未发布"},o.pre_state===4?i={color:"red",icon:e.jsx(d,{}),tooltip:"版本已回滚"}:o.pre_state===3?i={color:"success",icon:e.jsx(a,{}),tooltip:"版本已发布"}:o.pre_state===2&&o.pre_publish_id?i={color:"warning",icon:e.jsx(d,{}),tooltip:"版本已落后"}:i={color:"",icon:e.jsx(w,{}),tooltip:"版本未发布"},o.prd_state===4?c={color:"red",icon:e.jsx(d,{}),tooltip:"版本已回滚"}:o.prd_state===3?c={color:"success",icon:e.jsx(a,{}),tooltip:"版本已发布"}:o.prd_state===2&&o.prd_publish_id?c={color:"warning",icon:e.jsx(d,{}),tooltip:"版本已落后"}:c={color:"",icon:e.jsx(w,{}),tooltip:"版本未发布"},e.jsxs(e.Fragment,{children:[e.jsx(r,{title:n.tooltip,children:e.jsx(u,{color:n.color,icon:n.icon,children:"STG"})}),e.jsx(r,{title:i.tooltip,children:e.jsx(u,{color:i.color,icon:i.icon,children:"PRE"})}),e.jsx(r,{title:c.tooltip,children:e.jsx(u,{color:c.color,icon:c.icon,children:"PRD"})})]})};export{le as default};
