import{y as Ye,z as We,a7 as we,H as pe,a6 as Ie,a as ie,j as d,a5 as ze,ai as He,X as Be}from"./index-C0Gl-Hb5.js";import{N as Ue,Q as qe,F as Ke}from"./index-Br_U8lvB.js";var Qe="[object Symbol]";function me(e){return typeof e=="symbol"||Ye(e)&&We(e)==Qe}function Ge(e,t){for(var n=-1,r=e==null?0:e.length,o=Array(r);++n<r;)o[n]=t(e[n],n,e);return o}var Xe=1/0,ye=we?we.prototype:void 0,ve=ye?ye.toString:void 0;function Te(e){if(typeof e=="string")return e;if(pe(e))return Ge(e,Te)+"";if(me(e))return ve?ve.call(e):"";var t=e+"";return t=="0"&&1/e==-Xe?"-0":t}var Ze=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Je=/^\w*$/;function et(e,t){if(pe(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||me(e)?!0:Je.test(e)||!Ze.test(e)||t!=null&&e in Object(t)}var tt="Expected a function";function ge(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(tt);var n=function(){var r=arguments,o=t?t.apply(this,r):r[0],i=n.cache;if(i.has(o))return i.get(o);var a=e.apply(this,r);return n.cache=i.set(o,a)||i,a};return n.cache=new(ge.Cache||Ie),n}ge.Cache=Ie;var nt=500;function rt(e){var t=ge(e,function(r){return n.size===nt&&n.clear(),r}),n=t.cache;return t}var ot=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,it=/\\(\\)?/g,at=rt(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(ot,function(n,r,o,i){t.push(o?i.replace(it,"$1"):r||n)}),t});function ct(e){return e==null?"":Te(e)}function st(e,t){return pe(e)?e:et(e,t)?[e]:at(ct(e))}var lt=1/0;function ut(e){if(typeof e=="string"||me(e))return e;var t=e+"";return t=="0"&&1/e==-lt?"-0":t}function dt(e,t){t=st(t,e);for(var n=0,r=t.length;e!=null&&n<r;)e=e[ut(t[n++])];return n&&n==r?e:void 0}function ft(e,t,n){var r=e==null?void 0:dt(e,t);return r===void 0?n:r}function pt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function be(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function je(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?be(Object(n),!0).forEach(function(r){pt(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):be(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function mt(e,t){if(e==null)return{};var n={},r=Object.keys(e),o,i;for(i=0;i<r.length;i++)o=r[i],!(t.indexOf(o)>=0)&&(n[o]=e[o]);return n}function gt(e,t){if(e==null)return{};var n=mt(e,t),r,o;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)r=i[o],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function ht(e,t){return wt(e)||yt(e,t)||vt(e,t)||bt()}function wt(e){if(Array.isArray(e))return e}function yt(e,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var n=[],r=!0,o=!1,i=void 0;try{for(var a=e[Symbol.iterator](),c;!(r=(c=a.next()).done)&&(n.push(c.value),!(t&&n.length===t));r=!0);}catch(f){o=!0,i=f}finally{try{!r&&a.return!=null&&a.return()}finally{if(o)throw i}}return n}}function vt(e,t){if(e){if(typeof e=="string")return Me(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Me(e,t)}}function Me(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function bt(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function jt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Oe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function xe(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Oe(Object(n),!0).forEach(function(r){jt(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Oe(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function Mt(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(r){return t.reduceRight(function(o,i){return i(o)},r)}}function q(e){return function t(){for(var n=this,r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return o.length>=e.length?e.apply(this,o):function(){for(var a=arguments.length,c=new Array(a),f=0;f<a;f++)c[f]=arguments[f];return t.apply(n,[].concat(o,c))}}}function oe(e){return{}.toString.call(e).includes("Object")}function Ot(e){return!Object.keys(e).length}function Q(e){return typeof e=="function"}function xt(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function St(e,t){return oe(t)||V("changeType"),Object.keys(t).some(function(n){return!xt(e,n)})&&V("changeField"),t}function Pt(e){Q(e)||V("selectorType")}function Et(e){Q(e)||oe(e)||V("handlerType"),oe(e)&&Object.values(e).some(function(t){return!Q(t)})&&V("handlersType")}function Rt(e){e||V("initialIsRequired"),oe(e)||V("initialType"),Ot(e)&&V("initialContent")}function Ft(e,t){throw new Error(e[t]||e.default)}var Dt={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},V=q(Ft)(Dt),ee={changes:St,selector:Pt,handler:Et,initial:Rt};function It(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ee.initial(e),ee.handler(t);var n={current:e},r=q(kt)(n,t),o=q(Ct)(n),i=q(ee.changes)(e),a=q(Tt)(n);function c(){var w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(x){return x};return ee.selector(w),w(n.current)}function f(w){Mt(r,o,i,a)(w)}return[c,f]}function Tt(e,t){return Q(t)?t(e.current):t}function Ct(e,t){return e.current=xe(xe({},e.current),t),t}function kt(e,t,n){return Q(t)?t(e.current):Object.keys(n).forEach(function(r){var o;return(o=t[r])===null||o===void 0?void 0:o.call(t,e.current[r])}),n}var Nt={create:It},$t={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.43.0/min/vs"}};function Vt(e){return function t(){for(var n=this,r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return o.length>=e.length?e.apply(this,o):function(){for(var a=arguments.length,c=new Array(a),f=0;f<a;f++)c[f]=arguments[f];return t.apply(n,[].concat(o,c))}}}function At(e){return{}.toString.call(e).includes("Object")}function Lt(e){return e||Se("configIsRequired"),At(e)||Se("configType"),e.urls?(_t(),{paths:{vs:e.urls.monacoBase}}):e}function _t(){console.warn(Ce.deprecation)}function Yt(e,t){throw new Error(e[t]||e.default)}var Ce={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
    use
      monaco.config({ paths: { vs: '...' } })

    For more please check the link https://github.com/suren-atoyan/monaco-loader#config
  `},Se=Vt(Yt)(Ce),Wt={config:Lt},zt=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return function(o){return n.reduceRight(function(i,a){return a(i)},o)}};function ke(e,t){return Object.keys(t).forEach(function(n){t[n]instanceof Object&&e[n]&&Object.assign(t[n],ke(e[n],t[n]))}),je(je({},e),t)}var Ht={type:"cancelation",msg:"operation is manually canceled"};function ce(e){var t=!1,n=new Promise(function(r,o){e.then(function(i){return t?o(Ht):r(i)}),e.catch(o)});return n.cancel=function(){return t=!0},n}var Bt=Nt.create({config:$t,isInitialized:!1,resolve:null,reject:null,monaco:null}),Ne=ht(Bt,2),X=Ne[0],ae=Ne[1];function Ut(e){var t=Wt.config(e),n=t.monaco,r=gt(t,["monaco"]);ae(function(o){return{config:ke(o.config,r),monaco:n}})}function qt(){var e=X(function(t){var n=t.monaco,r=t.isInitialized,o=t.resolve;return{monaco:n,isInitialized:r,resolve:o}});if(!e.isInitialized){if(ae({isInitialized:!0}),e.monaco)return e.resolve(e.monaco),ce(se);if(window.monaco&&window.monaco.editor)return $e(window.monaco),e.resolve(window.monaco),ce(se);zt(Kt,Gt)(Xt)}return ce(se)}function Kt(e){return document.body.appendChild(e)}function Qt(e){var t=document.createElement("script");return e&&(t.src=e),t}function Gt(e){var t=X(function(r){var o=r.config,i=r.reject;return{config:o,reject:i}}),n=Qt("".concat(t.config.paths.vs,"/loader.js"));return n.onload=function(){return e()},n.onerror=t.reject,n}function Xt(){var e=X(function(n){var r=n.config,o=n.resolve,i=n.reject;return{config:r,resolve:o,reject:i}}),t=window.require;t.config(e.config),t(["vs/editor/editor.main"],function(n){$e(n),e.resolve(n)},function(n){e.reject(n)})}function $e(e){X().monaco||ae({monaco:e})}function Zt(){return X(function(e){var t=e.monaco;return t})}var se=new Promise(function(e,t){return ae({resolve:e,reject:t})}),Jt={config:Ut,init:qt,__getMonacoInstance:Zt};const G=Jt,en=window.React.memo,tn=window.React,Pe=window.React.useState,Y=window.React.useRef,Ee=window.React.useCallback,Re=window.React.useEffect,nn=window.React.memo,le=window.React;var rn={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}},ue=rn;const on=window.React;var an={container:{display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"}},cn=an;function sn({children:e}){return on.createElement("div",{style:cn.container},e)}var ln=sn,un=ln;function dn({width:e,height:t,isEditorReady:n,loading:r,_ref:o,className:i,wrapperProps:a}){return le.createElement("section",{style:{...ue.wrapper,width:e,height:t},...a},!n&&le.createElement(un,null,r),le.createElement("div",{ref:o,style:{...ue.fullWidth,...!n&&ue.hide},className:i}))}var fn=dn,Ve=nn(fn);const pn=window.React.useEffect;function mn(e){pn(e,[])}var he=mn;const gn=window.React.useEffect,hn=window.React.useRef;function wn(e,t,n=!0){let r=hn(!0);gn(r.current||!n?()=>{r.current=!1}:e,t)}var F=wn;function K(){}function W(e,t,n,r){return yn(e,r)||vn(e,t,n,r)}function yn(e,t){return e.editor.getModel(Ae(e,t))}function vn(e,t,n,r){return e.editor.createModel(t,n,r?Ae(e,r):void 0)}function Ae(e,t){return e.Uri.parse(t)}function bn({original:e,modified:t,language:n,originalLanguage:r,modifiedLanguage:o,originalModelPath:i,modifiedModelPath:a,keepCurrentOriginalModel:c=!1,keepCurrentModifiedModel:f=!1,theme:w="light",loading:x="Loading...",options:b={},height:E="100%",width:S="100%",className:P,wrapperProps:I={},beforeMount:T=K,onMount:z=K}){let[p,s]=Pe(!1),[O,m]=Pe(!0),h=Y(null),l=Y(null),N=Y(null),M=Y(z),y=Y(T),A=Y(!1);he(()=>{let u=G.init();return u.then(v=>(l.current=v)&&m(!1)).catch(v=>(v==null?void 0:v.type)!=="cancelation"&&console.error("Monaco initialization: error:",v)),()=>h.current?H():u.cancel()}),F(()=>{if(h.current&&l.current){let u=h.current.getOriginalEditor(),v=W(l.current,e||"",r||n||"text",i||"");v!==u.getModel()&&u.setModel(v)}},[i],p),F(()=>{if(h.current&&l.current){let u=h.current.getModifiedEditor(),v=W(l.current,t||"",o||n||"text",a||"");v!==u.getModel()&&u.setModel(v)}},[a],p),F(()=>{let u=h.current.getModifiedEditor();u.getOption(l.current.editor.EditorOption.readOnly)?u.setValue(t||""):t!==u.getValue()&&(u.executeEdits("",[{range:u.getModel().getFullModelRange(),text:t||"",forceMoveMarkers:!0}]),u.pushUndoStop())},[t],p),F(()=>{var u,v;(v=(u=h.current)==null?void 0:u.getModel())==null||v.original.setValue(e||"")},[e],p),F(()=>{let{original:u,modified:v}=h.current.getModel();l.current.editor.setModelLanguage(u,r||n||"text"),l.current.editor.setModelLanguage(v,o||n||"text")},[n,r,o],p),F(()=>{var u;(u=l.current)==null||u.editor.setTheme(w)},[w],p),F(()=>{var u;(u=h.current)==null||u.updateOptions(b)},[b],p);let Z=Ee(()=>{var $;if(!l.current)return;y.current(l.current);let u=W(l.current,e||"",r||n||"text",i||""),v=W(l.current,t||"",o||n||"text",a||"");($=h.current)==null||$.setModel({original:u,modified:v})},[n,t,o,e,r,i,a]),J=Ee(()=>{var u;!A.current&&N.current&&(h.current=l.current.editor.createDiffEditor(N.current,{automaticLayout:!0,...b}),Z(),(u=l.current)==null||u.editor.setTheme(w),s(!0),A.current=!0)},[b,w,Z]);Re(()=>{p&&M.current(h.current,l.current)},[p]),Re(()=>{!O&&!p&&J()},[O,p,J]);function H(){var v,$,L,B;let u=(v=h.current)==null?void 0:v.getModel();c||(($=u==null?void 0:u.original)==null||$.dispose()),f||((L=u==null?void 0:u.modified)==null||L.dispose()),(B=h.current)==null||B.dispose()}return tn.createElement(Ve,{width:S,height:E,isEditorReady:p,loading:x,_ref:N,className:P,wrapperProps:I})}var jn=bn;en(jn);const Mn=window.React.useState;function On(){let[e,t]=Mn(G.__getMonacoInstance());return he(()=>{let n;return e||(n=G.init(),n.then(r=>{t(r)})),()=>n==null?void 0:n.cancel()}),e}var xn=On;const Sn=window.React.memo,Pn=window.React,Fe=window.React.useState,te=window.React.useEffect,C=window.React.useRef,En=window.React.useCallback,Rn=window.React.useEffect,Fn=window.React.useRef;function Dn(e){let t=Fn();return Rn(()=>{t.current=e},[e]),t.current}var In=Dn,ne=new Map;function Tn({defaultValue:e,defaultLanguage:t,defaultPath:n,value:r,language:o,path:i,theme:a="light",line:c,loading:f="Loading...",options:w={},overrideServices:x={},saveViewState:b=!0,keepCurrentModel:E=!1,width:S="100%",height:P="100%",className:I,wrapperProps:T={},beforeMount:z=K,onMount:p=K,onChange:s,onValidate:O=K}){let[m,h]=Fe(!1),[l,N]=Fe(!0),M=C(null),y=C(null),A=C(null),Z=C(p),J=C(z),H=C(),u=C(r),v=In(i),$=C(!1),L=C(!1);he(()=>{let g=G.init();return g.then(j=>(M.current=j)&&N(!1)).catch(j=>(j==null?void 0:j.type)!=="cancelation"&&console.error("Monaco initialization: error:",j)),()=>y.current?_e():g.cancel()}),F(()=>{var j,R,U,_;let g=W(M.current,e||r||"",t||o||"",i||n||"");g!==((j=y.current)==null?void 0:j.getModel())&&(b&&ne.set(v,(R=y.current)==null?void 0:R.saveViewState()),(U=y.current)==null||U.setModel(g),b&&((_=y.current)==null||_.restoreViewState(ne.get(i))))},[i],m),F(()=>{var g;(g=y.current)==null||g.updateOptions(w)},[w],m),F(()=>{!y.current||r===void 0||(y.current.getOption(M.current.editor.EditorOption.readOnly)?y.current.setValue(r):r!==y.current.getValue()&&(L.current=!0,y.current.executeEdits("",[{range:y.current.getModel().getFullModelRange(),text:r,forceMoveMarkers:!0}]),y.current.pushUndoStop(),L.current=!1))},[r],m),F(()=>{var j,R;let g=(j=y.current)==null?void 0:j.getModel();g&&o&&((R=M.current)==null||R.editor.setModelLanguage(g,o))},[o],m),F(()=>{var g;c!==void 0&&((g=y.current)==null||g.revealLine(c))},[c],m),F(()=>{var g;(g=M.current)==null||g.editor.setTheme(a)},[a],m);let B=En(()=>{var g;if(!(!A.current||!M.current)&&!$.current){J.current(M.current);let j=i||n,R=W(M.current,r||e||"",t||o||"",j||"");y.current=(g=M.current)==null?void 0:g.editor.create(A.current,{model:R,automaticLayout:!0,...w},x),b&&y.current.restoreViewState(ne.get(j)),M.current.editor.setTheme(a),c!==void 0&&y.current.revealLine(c),h(!0),$.current=!0}},[e,t,n,r,o,i,w,x,b,a,c]);te(()=>{m&&Z.current(y.current,M.current)},[m]),te(()=>{!l&&!m&&B()},[l,m,B]),u.current=r,te(()=>{var g,j;m&&s&&((g=H.current)==null||g.dispose(),H.current=(j=y.current)==null?void 0:j.onDidChangeModelContent(R=>{L.current||s(y.current.getValue(),R)}))},[m,s]),te(()=>{if(m){let g=M.current.editor.onDidChangeMarkers(j=>{var U;let R=(U=y.current.getModel())==null?void 0:U.uri;if(R&&j.find(_=>_.path===R.path)){let _=M.current.editor.getModelMarkers({resource:R});O==null||O(_)}});return()=>{g==null||g.dispose()}}return()=>{}},[m,O]);function _e(){var g,j;(g=H.current)==null||g.dispose(),E?b&&ne.set(i,y.current.saveViewState()):(j=y.current.getModel())==null||j.dispose(),y.current.dispose()}return Pn.createElement(Ve,{width:S,height:P,isEditorReady:m,loading:f,_ref:A,className:I,wrapperProps:T})}var Cn=Tn,kn=Sn(Cn),Nn=kn;const D=window.dayjs,cr=(e="mars",t=11)=>e+"_"+Number(Math.random().toString().substring(2,12)+Date.now()).toString(36).slice(0,t),sr=(e,t)=>{if(!e)return"0.00";const n=parseFloat(e.toString());return isNaN(n)?e:t?n.toLocaleString("zh-CN",{style:t,currency:"CNY"}):n.toLocaleString()},lr=(e,t="YYYY-MM-DD HH:mm:ss")=>e?D(e).format(t):"",ur=e=>{const t=new Date;if(e)return e=="today"||(e=="yestoday"&&t.setDate(t.getDate()-1),e=="last7"&&t.setDate(t.getDate()-7),e=="last30"&&t.setMonth(t.getMonth()-1),e=="last90"&&t.setMonth(t.getMonth()-3)),D(t.toLocaleString())},dr=e=>{const t=new Date,n=new Date;if(!e)return[void 0,void 0];if(["today","curWeek","curMonth","curYear","curQuarter"].includes(e)){if(e!="today"){if(e=="curWeek")t.setDate(t.getDate()-t.getDay()+1);else if(e=="curMonth")t.setDate(1);else if(e=="curYear")t.setDate(1),t.setMonth(0);else if(e=="curQuarter"){t.setDate(1);const r=t.getMonth();t.setMonth(Math.floor(r/3)*3)}}return[D(t.toLocaleString()),D(n.toLocaleString())]}if(["yestoday","lastWeek","lastMonth","last3Month","lastYear"].includes(e))return e=="yestoday"?t.setDate(t.getDate()-1):e=="lastWeek"?t.setDate(t.getDate()-7):e=="lastMonth"?t.setMonth(t.getMonth()-1):e=="last3Month"?t.setMonth(t.getMonth()-3):e=="lastYear"&&t.setFullYear(t.getFullYear()-1),[D(t.toLocaleString()),D(n.toLocaleString())]},fr=e=>e==null,re=e=>!(e===""||e===void 0||e===null);function pr(e){return navigator.clipboard.writeText(e)}function De(e,t){return e==null?void 0:e.replace(/\$\{([^}]+)\}/g,(n,r)=>{if(r.includes("?"))try{return new Function("param",`return param.${r}`)(t)}catch{return r}return ft(t,r)})}function $n(e){const t=ie.getState().page,n={};return t.variables.forEach(r=>{n[r.name]=t.variableData[r.name]??r.defaultValue}),e?n[e]:n}function Vn(e,t){const n=t.replace(/^\s*\/\/.*$/gm,"").replace(/\/\*[\s\S]*?\*\//g,"").trim(),r=Array.isArray(e)?e.join(", "):e;if(n.startsWith("function"))return new Function(r,`return ${n};`);const o=n.indexOf("return")>-1?n:`return ${n};`;return new Function(r,o)}function Le(e,t={}){try{if(!e)return"";const n=e.match(/([A-Za-z]+_\w+)\.[\w\.]*/g)||[],r=[...new Set(n.map(b=>b.split(".")[0]))],o=["context","variable","eventParams","FORMAT"],i=[];r.forEach(b=>{var P;o.push(b);const S=((P=ie.getState().page.formData)==null?void 0:P[b])||{};i.push(S)});const a=$n(),c=Vn(o,e),f=(b,E="YYYY-MM-DD HH:mm:ss")=>D(b).format(E),w={variable:a,eventParams:t,FORMAT:f,...i},x=c(w,a,t||{},f,...i);return typeof x=="function"?x(w,a,t||{},f,...i):x}catch(n){console.error("表达式解析失败：",n)}return""}const mr=(e,t)=>{const n=ie.getState().page.elementsMap;return e.filter(r=>["DatePicker","TimePicker","DatePickerRange","TimePickerRange","EditTable"].includes(r.type)).map(r=>{var w,x,b,E;const{startField:o,endField:i,formItem:{name:a},formWrap:{format:c,columns:f}}=n[r.id].config.props;if(["DatePicker","TimePicker"].includes(r.type)){if(!t[a])return;t[a]=((x=(w=t[a])==null?void 0:w.format)==null?void 0:x.call(w,c))||D(t[a])}else if(["DatePickerRange","TimePickerRange"].includes(r.type))if(((b=t[a])==null?void 0:b.length)==2){const[S,P]=((E=t[a])==null?void 0:E.map(I=>{var T;return((T=I==null?void 0:I.format)==null?void 0:T.call(I,c))||D(t[I])}))||[void 0,void 0];o&&i&&(t[o]=S,t[i]=P,delete t[a])}else t[o]&&t[i]&&(t[a]=[D(t[o]),D(t[i])]);else r.type==="EditTable"&&f.filter(S=>S.type==="date").map(({dataIndex:S})=>{t[a].map(P=>{P[S]&&(P[S]=D(P[S]))})})}),t},gr=(e={},t)=>Object.keys(e).reduce((n,r)=>{const o=e[r];return typeof o=="object"?(o==null?void 0:o.type)==="static"?n[r]=o.value:(o==null?void 0:o.type)==="variable"?n[r]=Le(o.value,t):n[r]=o:n[r]=o,n},{}),hr=(e=[],t={})=>e.reduce((n,r)=>{if(r.key)if(typeof r.value=="string")if(re(r.value)){const o=De(r.value,t);n[r.key]=isNaN(o)?o:Number(o)}else n[r.key]=void 0;else if(r.value.type==="static")if(re(r.value)){const o=De(r.value.value,t);n[r.key]=isNaN(o)?o:Number(o)}else n[r.key]=void 0;else{const o=Le(r.value.value);n[r.key]=re(o)?o:void 0}return n},{}),wr=(e,t)=>{if(t)return new Promise((n,r)=>{if(document.getElementById(e))return;const o=document.createElement("link");o.rel="stylesheet",o.type="text/css",o.href=t,o.id=e,o.onload=n,o.onerror=r,document.getElementsByTagName("HEAD")[0].appendChild(o)})},yr=()=>{var c;const e=(c=document.documentElement.dataset)==null?void 0:c.vanEnv,t=/^\/editor\/\d+\/edit/.test(location.pathname),n=/^\/page\/(stg|pre|prd)\/\d+/.test(location.pathname),r=/^\/project\/(stg|pre|prd)\/\d+/.test(location.pathname),o=location.pathname.match(/^\/page\/(stg|pre|prd)\/\d+/),i=location.pathname.match(/^\/project\/(stg|pre|prd)\/\d+/),a=o?o[1]:i?i[1]:"stg";return{vanEnv:e,isDev:t,isPage:n,isProject:r,env:a}},An=window.React.useEffect,Ln=window.React.useRef;function _n({height:e,language:t,value:n,onChange:r}){const o=xn(),i=Ln(null);An(()=>{o==null||o.languages.registerCompletionItemProvider("javascript",{provideCompletionItems:function(c,f){const w=c.getWordUntilPosition(f),x={startLineNumber:f.lineNumber,endLineNumber:f.lineNumber,startColumn:w.startColumn,endColumn:w.endColumn};return{suggestions:a(x)}}})},[o]);function a(c){return o?[{label:"context",kind:o.languages.CompletionItemKind.Function,documentation:"context是一个全局上下文变量",insertText:"context",range:c},{label:"variable",kind:o.languages.CompletionItemKind.Function,documentation:"variable是一个系统变量",insertText:"variable",range:c},{label:"eventParams",kind:o.languages.CompletionItemKind.Function,documentation:"eventParams是事件流参数",insertText:"eventParams",range:c}]:[]}return G.config({paths:{vs:"https://static.huolala.cn/npm/monaco-editor@0.44.0/min/vs"}}),d.jsx(Nn,{height:e||"150px",language:t||"javascript",value:re(n)?typeof n=="string"?n:JSON.stringify(n,null,2):"",onChange:r,onMount:(c,f)=>{i.current={editor:c,monaco:f}},options:{lineNumbers:"on",minimap:{enabled:!1}}})}const Yn="_container_j8mf6_1",Wn="_leftFn_j8mf6_6",zn="_box_j8mf6_23",Hn="_content_j8mf6_27",Bn="_title_j8mf6_30",Un="_variable_j8mf6_38",k={container:Yn,leftFn:Wn,box:zn,content:Hn,title:Bn,variable:Un},de=window.antd.Button,qn=window.antd.Collapse,fe=window.antd.Form,Kn=window.antd.Modal,Qn=window.antd.Popover,Gn=window.antd.Tree,Xn=window.React.forwardRef,Zn=window.React.useCallback,Jn=window.React.useImperativeHandle,er=window.React.useState,tr=({onSelect:e},t)=>{const[n,r]=er(!1),[o]=fe.useForm(),{variables:i,pageName:a,elements:c,elementsMap:f}=ie(p=>({variables:p.page.variables,pageName:p.page.pageName,elements:p.page.elements,elementsMap:p.page.elementsMap})),w=Zn(()=>{const p=[];return Object.keys(f).map(s=>{var O;if(s.startsWith("SearchForm_")||s.startsWith("Form_")||s.startsWith("MarsTable_")){const m=ze(He(c),s);(O=m.elements)==null||O.map(h=>{const l=f[h.id].config.props.formItem;l?h.name=`${l.label}(${l.name})`:h.name=""}),m.elements&&(m.elements=m.elements.filter(h=>h.name)),m&&p.push(m)}}),p},[f]),x=[{name:`页面【${a}】`,id:"page",elements:[{name:"全局变量",id:"PageVariable",type:"PageVariable",elements:b(i)},...w()]}];function b(p){return p.map(s=>{const{name:O,type:m,defaultValue:h}=s,l={name:O,value:h,elements:[]};return m==="array"?(l.type="Variable",l.id=s.name,l.name=`Array<${s.name}>${s.remark?"("+s.remark+")":""}`):m==="object"?(l.id=s.name,l.name=`${s.name}${s.remark?"("+s.remark+")":""}`,l.type="Variable",l.elements=b(Object.entries(h).map(([N,M])=>({type:Array.isArray(M)?"array":typeof M,id:s.name+"."+N,name:s.name+"."+N,defaultValue:M})))):(l.type="Variable",l.id=s.name,l.name=`${s.name}${s.remark?"("+s.remark+")":""}`),l})}Jn(t,()=>({open(p){o.setFieldValue("expression",p),r(!0)}}));const E=p=>{p==="table"?o.setFieldValue("expression",`function render(text, record, index) {
    return text;
}`):p==="expression"?o.setFieldValue("expression","status === 1 ? '启用' : '禁用'"):p==="function"&&o.setFieldValue("expression",`function run(eventParams) {
    return '';
}`)},S=(p,{node:s})=>{var m,h;if(!s.type)return;const O=o.getFieldValue("expression")??"";if(s.type==="Variable"){o.setFieldValue("expression",`${O} variable.${s.id}`.trimStart());return}if(s.type==="PageVariable")o.setFieldValue("expression",`${O} variable`);else if(s.type==="EditTable"){const l=(m=f[s.id])==null?void 0:m.config.props.field;l&&o.setFieldValue("expression",`${O} ${s.parentId}.${l}`.trimStart())}else if(s.type==="Form")o.setFieldValue("expression",`${O}  ${s.id}`);else{const l=(h=f[s.id])==null?void 0:h.config.props.formItem;o.setFieldValue("expression",`${O} ${s.parentId}.${l.name}`.trimStart())}},P=p=>{const s=o.getFieldValue("expression")??"";o.setFieldValue("expression",`${s} ${p}()`.trimStart())},I=()=>{const p=o.getFieldValue("expression");e({value:p}),T()},T=()=>{r(!1)},z=[{key:"1",label:"逻辑函数",children:null},{key:"2",label:"数学函数",children:null},{key:"3",label:"日期函数",children:d.jsx("ul",{children:d.jsx("li",{onClick:()=>P("FORMAT"),children:"FORMAT"})})},{key:"4",label:"数组函数",children:null}];return d.jsxs(Kn,{open:n,onCancel:T,title:"逻辑编辑器",width:1100,onOk:I,okText:"确认",cancelText:"取消",children:[d.jsxs("div",{style:{marginBlock:10},children:[d.jsx(Ue,{style:{color:"#7D33FF"}}),d.jsx("span",{style:{marginLeft:5},children:"下表为页面定义的全局变量，选择时，直接鼠标点击对应的行即可。"})]}),d.jsxs("div",{className:k.container,children:[d.jsxs("div",{className:k.leftFn,children:[d.jsx("div",{className:k.title,children:"计算函数"}),d.jsx("div",{className:k.box,children:d.jsx(qn,{ghost:!0,items:z,style:{marginTop:-13}})})]}),d.jsxs("div",{className:k.content,children:[d.jsxs("div",{className:k.title,children:["表达式",d.jsx(Qn,{content:d.jsxs("div",{children:[d.jsx("p",{children:"1. 默认支持普通变量定义，最终会返回该解析后的变量值：variable.current "}),d.jsx("p",{children:"2. 支持三元表达式：userName === 'jack' ? 1 : 2 "}),d.jsxs("p",{children:["3. 支持逻辑判断：if( a ",">"," 1 ) return 1; return 2 "]}),d.jsxs("p",{children:["4. 支持函数function定义：function getName()",'{ return "jack" } ']}),d.jsx("p",{children:"5. 定义函数的时候，不支持自定义参数，参数只能是从右侧选择的变量或者表单对象，系统会自动解析。"}),d.jsxs("p",{children:["6. 表格自定义渲染时，需要手工定义渲染函数：function render(text, record, index) ","{ return text; }"]})]}),children:d.jsx(qe,{style:{marginLeft:10,cursor:"pointer"}})}),d.jsx(de,{type:"link",onClick:()=>E("expression"),children:"三元表达式模板"}),d.jsx(de,{type:"link",onClick:()=>E("function"),children:"函数模板"}),d.jsx(de,{type:"link",onClick:()=>E("table"),children:"表格自定义渲染模板"})]}),d.jsx("div",{className:k.formula,children:d.jsx(fe,{form:o,children:d.jsx(fe.Item,{noStyle:!0,name:"expression",children:d.jsx(_n,{height:"440px",language:"javascript"})})})})]}),d.jsxs("div",{className:k.variable,children:[d.jsx("div",{className:k.title,children:"参数和变量"}),d.jsx(Gn,{showLine:!0,defaultExpandAll:!0,switcherIcon:d.jsx(Be,{}),fieldNames:{title:"name",key:"id",children:"elements"},treeData:x,onSelect:S})]})]})]})},nr=Xn(tr),rr=window.antd.Input,or=window.React.useRef,vr=({value:e,onChange:t,...n})=>{const r=or();function o(c){var f;t({type:"static",value:(f=c==null?void 0:c.target)==null?void 0:f.value})}function i(c){t({type:"variable",...c})}const a=typeof e=="string"?{type:"static",value:e}:e;return d.jsxs(d.Fragment,{children:[d.jsx(rr,{readOnly:(a==null?void 0:a.type)==="variable"&&a.value,allowClear:!0,value:a==null?void 0:a.value,onChange:o,addonAfter:d.jsx(Ke,{onClick:()=>{var c;(c=r.current)==null||c.open(a==null?void 0:a.value)},style:{color:(e==null?void 0:e.type)==="variable"?"#7D33FF":""}}),placeholder:"请选择变量",...n}),d.jsx(nr,{ref:r,onSelect:i})]})};export{Nn as F,_n as V,vr as a,et as b,st as c,dt as d,Ge as e,yr as f,ft as g,hr as h,me as i,Le as j,gr as k,G as l,re as m,pr as n,wr as o,fr as p,sr as q,De as r,lr as s,ut as t,cr as u,mr as v,ur as w,dr as x};
