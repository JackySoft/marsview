import{o as M,aQ as $,aR as N,j as e,aS as B,aT as D,m as O,aU as q,M as z,aV as H}from"./index-CSGxKpEX.js";import{S as G}from"./SearchForm-D2m3F1eF.js";const K=window.React.useImperativeHandle,i=window.React.useState,P=window.antd.Modal,c=window.antd.Form,Q=window.antd.Input,_=window.antd.Select,k=window.antd.Radio,J=window.antd.Spin,W=window.ahooks.useDebounceFn;function X(f){const[o]=c.useForm(),[d,y]=i("create"),[j,u]=i(1),[I,R]=i([]),[S,m]=i([]),[g,h]=i(!1),[p,a]=i(!1),[b,l]=i(!1),r=M().id;K(f.mRef,()=>({open:v}));const v=async(t,n)=>{y(t),h(!0),u((n==null?void 0:n.system_role)||1),a(!0),l(!1);try{const w=await $(parseInt(r));m(w),a(!1),n&&r&&o.setFieldsValue({...n,project_id:parseInt(r)})}catch{a(!1)}},F=t=>{u(t)},{run:L}=W(t=>{t&&N(t).then(n=>{R(n)})},{wait:500}),C=async()=>{if(!r)return;if(await o.validateFields()){l(!0);const{id:n,system_role:w,role_id:U="",sso_info:{label:A,value:E}={label:"",value:""}}=o.getFieldsValue();try{d==="create"?await B({system_role:w,user_id:E,user_name:A,project_id:parseInt(r),role_id:U}):await D({id:n,system_role:w,role_id:U}),l(!1),O.success("操作成功"),s(),f.update()}catch{l(!1)}}},s=()=>{h(!1),u(1),o.resetFields()};return e.jsx(e.Fragment,{children:e.jsx(P,{title:d==="create"?"创建用户":"编辑用户",width:600,open:g,okText:"确定",cancelText:"取消",confirmLoading:b,onOk:C,onCancel:s,children:e.jsx(J,{spinning:p,children:e.jsxs(c,{form:o,labelAlign:"right",labelCol:{span:4},initialValues:{system_role:1},children:[e.jsx(c.Item,{hidden:!0,name:"id",children:e.jsx(Q,{})}),e.jsx(c.Item,{label:"系统角色",name:"system_role",extra:"管理员拥有本系统所有功能权限，普通用户需要通过RBAC分配角色权限",children:e.jsxs(k.Group,{onChange:t=>F(t.target.value),children:[e.jsx(k,{value:1,children:"管理员"}),e.jsx(k,{value:2,children:"普通用户"})]})}),d==="create"&&e.jsx(c.Item,{label:"用户",name:"sso_info",rules:[{required:!0,message:"请输入飞书用户名"}],children:e.jsx(_,{labelInValue:!0,filterOption:!0,showSearch:!0,onSearch:L,children:I.map(t=>e.jsx(_.Option,{value:t.account,children:t.username},t.account))})}),j===2&&e.jsx(c.Item,{label:"角色",name:"role_id",rules:[{required:!0,message:"请输入菜单名称"}],children:e.jsx(_,{showSearch:!0,children:S.map(t=>e.jsx(_.Option,{value:t.id,children:t.name},t.id))})})]})})})})}const Y=window.React.useEffect,Z=window.React.useRef,x=window.React.useState,V=window.antd.Form,ee=window.antd.Input,T=window.antd.Button,te=window.antd.Table,se=window.antd.Space;function re(){const[f,o]=x([]),[d,y]=x(0),[j,u]=x(1),[I,R]=x([]),[S,m]=x(!1),[g]=V.useForm(),h=M().id,p=Z();Y(()=>{b(),a()},[]);const a=async(s=j)=>{try{m(!0);const{name:t}=g.getFieldsValue(),n=await q({pageNum:s,pageSize:10,project_id:parseInt(h),user_name:t});m(!1),y((n==null?void 0:n.total)||0),o((n==null?void 0:n.list)||[])}catch{m(!1)}},b=async()=>{const s=await $(parseInt(h));R(s)},l=s=>{u(s),a(s)},r=()=>{var s;(s=p.current)==null||s.open("create")},v=s=>{var t;(t=p.current)==null||t.open("edit",s)},F=s=>{z.confirm({title:"确认",content:`确认删除 ${s.user_name} 吗？`,onOk(){H({id:s.id}).then(()=>{O.success("删除成功"),a()})}})},L=[{title:"用户名称",dataIndex:"sso_name",key:"sso_name"},{title:"系统角色",dataIndex:"system_role",render(s){return s===1?"管理员":"普通用户"}},{title:"角色列表",dataIndex:"role_id",render(s){var t;return(t=I.find(n=>n.id===s))==null?void 0:t.name}},{title:"更新时间",dataIndex:"updated_at",key:"updated_at"},{title:"创建时间",dataIndex:"created_at",key:"created_at"},{title:"操作",key:"action",render(s,t){return e.jsxs(se,{children:[e.jsx(T,{type:"text",onClick:()=>v(t),children:"编辑"}),e.jsx(T,{type:"text",danger:!0,onClick:()=>F(t),children:"删除"})]})}}],C={current:j,total:d,pageSize:10,showTotal:s=>`共 ${s} 条`,onChange:l};return e.jsxs("div",{children:[e.jsx(G,{form:g,submit:a,reset:a,children:e.jsx(V.Item,{label:"用户名称",name:"name",children:e.jsx(ee,{placeholder:"用户名称"})})}),e.jsxs("div",{className:"base-table",children:[e.jsxs("div",{className:"header-wrapper",children:[e.jsx("div",{className:"title",children:"用户列表"}),e.jsx("div",{className:"action",children:e.jsx(T,{type:"primary",onClick:r,children:"新增"})})]}),e.jsx(te,{bordered:!0,rowKey:"id",loading:S,columns:L,dataSource:f,pagination:C})]}),e.jsx(X,{mRef:p,update:a})]})}export{re as default};
