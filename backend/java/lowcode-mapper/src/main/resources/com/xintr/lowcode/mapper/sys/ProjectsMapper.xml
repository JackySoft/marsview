<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xintr.lowcode.mapper.sys.ProjectsMapper">
    <resultMap extends="BaseResultMap" id="ResultMapWithBLOBs" type="com.xintr.lowcode.api.domain.Projects">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on 2024-09-27 10:19:24.
        -->
        <result column="logo" jdbcType="LONGVARCHAR" property="logo"/>
    </resultMap>
    <resultMap id="BaseResultMap" type="com.xintr.lowcode.api.domain.Projects">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on 2024-09-27 10:19:24.
        -->
        <id column="id" jdbcType="BIGINT" property="id"/>
        <result column="name" jdbcType="VARCHAR" property="name"/>
        <result column="updated_at" jdbcType="TIMESTAMP" property="updated_at"/>
        <result column="created_at" jdbcType="TIMESTAMP" property="created_at"/>
        <result column="remark" jdbcType="VARCHAR" property="remark"/>
        <result column="appid" jdbcType="VARCHAR" property="appid"/>
        <result column="visit_type" jdbcType="INTEGER" property="visit_type"/>
        <result column="user_name" jdbcType="VARCHAR" property="user_name"/>
        <result column="user_id" jdbcType="BIGINT" property="user_id"/>
        <result column="is_public" jdbcType="INTEGER" property="is_public"/>
        <result column="breadcrumb" jdbcType="BOOLEAN" property="breadcrumb"/>
        <result column="layout" jdbcType="INTEGER" property="layout"/>
        <result column="menu_mode" jdbcType="VARCHAR" property="menu_mode"/>
        <result column="menu_theme_color" jdbcType="VARCHAR" property="menu_theme_color"/>
        <result column="tag" jdbcType="BOOLEAN" property="tag"/>
        <result column="footer" jdbcType="BOOLEAN" property="footer"/>
        <result column="system_theme_color" jdbcType="VARCHAR" property="system_theme_color"/>
    </resultMap>

    <resultMap id="dtoMap" type="com.xintr.lowcode.api.dto.ProjectsDto" extends="BaseResultMap">

    </resultMap>

    <!--分页查询项目信息-->
    <select id="dataList" resultMap="dtoMap">
        select *
        from projects
        <where>
            <choose>
                <when test="type == 1">
                    and user_id = #{user_id}
                </when>
                <otherwise>
                    and is_public = '1'
                </otherwise>
            </choose>
            <if test=" keyword != null and keyword != '' and vagueMatch != null and vagueMatch.length > 0">
                and
                <foreach collection="vagueMatch" item="item" index="index" open="(" close=")" separator="or">
                    ${item} like concat('%', '${keyword}', '%')
                </foreach>
            </if>
        </where>
    </select>

    <!--分页查询项目信息-->
    <select id="projectList" resultMap="dtoMap">
        select b.id, b.logo, b.name, b.remark, b.updated_at
        from project_user a
                 left join projects b
                           on a.project_id = b.id
        where a.user_id = #{user_id}
    </select>
</mapper>
